<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
<h:head>
    <meta charset="UTF-8"/>
    <h:title>Web Lab 3</h:title>
    <h:outputScript library="primefaces" name="jquery/jquery.js"/>
</h:head>

<h:body>
<h:panelGroup layout="block" styleClass="container">
    <h:panelGroup layout="block" styleClass="row">
        <h:form id="pointForm" styleClass="pointForm">
            <p:messages id="messages" autoUpdate="true" closable="true" showDetail="false" showSummary="false"/>
            <fieldset>
                <legend>Select X:</legend>
                <h:outputLabel value="X"/>
                <p:spinner value="#{coordinateBean.x}" required="true" min="-5" max="5" stepFactor="0.1"></p:spinner>
            </fieldset>
            <fieldset>
                <legend>Select Y:</legend>
                <p:inputText value="#{controllerBean.coordinate.y}" placeholder="От -3 до 3" pt:data-id="y-input"/>
            </fieldset>
            <fieldset>
                <legend>Select R:</legend>
                <p:spinner id="rSpinner" value="#{coordinateBean.r}" required="true" min="0.1" max="3" stepFactor="0.1" widgetVar="spinnerR"></p:spinner>
            </fieldset>

            <p:commandButton value="Add point"
                             action="#{controllerBean.submitFromForm}"
                             update="pointsTable"
                             process="@form"
                             oncomplete="drawPoints();">
            </p:commandButton>

            <p:remoteCommand name="sendCoordinates"
                             action="#{controllerBean.submitFromClick}"
                             process="@form"
                             update="pointsTable"
                             oncomplete="drawPoints();">
                <f:param name="clickX" />
                <f:param name="clickY" />
                <f:param name="clickR" />
            </p:remoteCommand>

            <h:panelGroup id="canvasPanel"
                          layout="block"
                          styleClass="text-align: center; margin-top: 20px;">
                <h:panelGroup layout="block"
                              styleClass="flex justify-center overflow-auto rounded-lg border border-white dark:border-custom-dark shadow-md backdrop-blur-3xl">
                    <canvas id="graphCanvas" width="300" height="300" class="graph"/>
                </h:panelGroup>
            </h:panelGroup>

            <h:dataTable id="pointsTable" value="#{controllerBean.resultsList}" var="res">
                <h:column>
                    <f:facet name="header">X</f:facet>
                    #{res.x}
                </h:column>
                <h:column>
                    <f:facet name="header">Y</f:facet>
                    #{res.y}
                </h:column>
                <h:column>
                    <f:facet name="header">R</f:facet>
                    #{res.r}
                </h:column>
                <h:column>
                    <f:facet name="header">Result</f:facet>
                    #{res.hit ? 'hit' : 'no'}
                </h:column>
                <h:column>
                    <f:facet name="header">Exec. Time</f:facet>
                    #{res.execTime}
                </h:column>
                <h:column>
                    <f:facet name="header">Time</f:facet>
                    #{res.time}
                </h:column>
            </h:dataTable>
        </h:form>
    </h:panelGroup>

    <h:button value="Стартовая страница" outcome="goToIndex" styleClass="nav-button"/>
</h:panelGroup>

    <script type="module" src="#{request.contextPath}/resources/scripts/main.js"></script>

</h:body>
</html>